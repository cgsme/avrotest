## avro
-- 
#### avro介绍
Apache avro是一种数据序列化系统。

Avro出自Hadoop之父Doug Cutting, 在Thrift已经相当流行的情况下推出Avro，其目标不仅是提供一套类似Thrift的通讯中间件,更是要建立一个新的、标准性的云计算的数据交换和存储的Protocol。
这个和Thrift的理念不同，Thrift出自Facebook用于后台各个服务间的通讯,Thrift的设计强调统一的编程接口的多语言通讯框架。
Thrift认为没有一个完美的方案可以解决所有问题，因此尽量保持一个中立的框架，插入不同的实现并互相交互。
而Avro偏向实用，排斥多种方案带来的可能的混乱，主张建立一个统一的标准，并不介意采用特定的优化。
Avro的创新之处在于融合了显式声明的Schema和高效二进制的数据表达，强调数据的自我描述，克服了以往单纯XML或二进制系统的缺陷。
Avro对Schema动态加载功能，是Thrift编程接口所不具备的，符合了Hadoop上的Hive/Pig及NOSQL 等既属于[ad hoc](https://baike.baidu.com/item/Ad%20hoc/534288?fr=aladdin)（点对点网络模式），又追求性能的应用需求。

avro提供：
* 丰富的数据格式(规范中介绍)
* 紧凑，快速的二进制数据格式
* 容器文件，用于存储持久的数据
* 远程过程调用（RPC）
* 与动态语言(js\php\asp\ruby\python等)的简单集成。读取或写入文件时不需要使用代码生成，也不需要使用或实现RPC协议。代码生成作为可选的优化组合，仅值得在静态语言(java\c++\c#等)下实现。


#### schema（模式）
1. avro依赖与schema。读取Avro数据时，始终存在写入时使用的模式。这允许每个数据写入时不会产生每个值的开销，从而使序列化既快又小。这也方便于使用动态脚本语言，因为数据及其模式完全是自我描述的。
2. 因为avro数据被存储在文件中时，其schema也一同被存储。所以该文件可以被任何程序处理。如果程序读取数据时需要另一种schema也很容易解决，因为这两种schema都存在。
3. 当avro使用在RPC中时，客户端和服务端在连接握手中交换schema（可以优化，对于大多数调用并不会交换schema）由于客户端和服务器都具有另一个完整模式，因此相同命名字段，缺少字段，额外字段等之间的对应关系都可以轻松解决。
4. avro schema使用json定义，这便于在已有json库的语言中实现。


#### 与其他系统进行比较
Avro提供类似于诸如[Thrift](http://thrift.apache.org/)，[Protocol Buffers](http://code.google.com/p/protobuf/)等系统的功能[.Avro](http://thrift.apache.org/)在以下基本方面与这些系统不同。
* 动态类型：Avro不需要生成代码。数据始终伴随着一种schema，该schema允许在不生成代码，静态数据类型等的情况下完全处理该数据。这有助于构建通用数据处理系统和语言。
* 无标记数据：由于在读取数据时存在模式，因此需要进行编码的类型信息少的多，因此序列化大小较小。
* 没有手动分配的字段ID：当schema改变时，处理数据时始终存在旧schema和新schema，因此，可以使用字段名象征性地解决差异。

与[Thrift](https://www.cnblogs.com/AI001/p/3996846.html)<br>
Avro和Thrift都是跨语言，基于二进制的高性能的通讯中间件. 它们都提供了数据序列化的功能和RPC服务。
总体功能上类似，但是哲学不一样. Thrift出自Facebook用于后台各个服务间的通讯,Thrift的设计强调统一的编程接口的多语言通讯框架。
Avro的推出，其目标不仅是提供一套类似Thrift的通讯中间件更是要建立一个新的，标准性的云计算的数据交换和存储的Protocol。
这个和Thrift的理念不同，Thrift认为没有一个完美的方案可以解决所有问题，因此尽量保持一个Neutral框架，插入不同的实现并互相交互。
而Avro偏向实用，排斥多种方案带来的 可能的混乱，主张建立一个统一的标准，并不介意采用特定的优化。
Avro的创新之处在于融合了显式,declarative的Schema和高效二进制的数据表达，强调数据的自我描述，克服了以往单纯XML或二进制系统的缺陷。
Avro对Schema动态加载功能，是Thrift编程接口所不具备的，符合了Hadoop上的Hive/Pig及NOSQL 等既属于ad hoc，又追求性能的应用需求。

结论：
    Thrift适用于程序对程序静态的数据交换，要求schema预知并相对固定。
    Avro在Thrift基础上增加了对schema动态的支持且性能上不输于Thrift。
    Avro显式地设计schema使它更适用于搭建数据交换及存储的通用工具和平台,特别是在后台。
    目前Thrift的优势在于更多的语言支持和相对成熟。

----

#### 为什么使用Avro
因为他是Hadoop的一个子项目 -_-
As we know，JSON是一种轻量级的数据传输格式，对于大数据集，JSON数据会显示力不从心，因为JSON的格式是key：value型，每条记录都要附上key的名字。
有的时候，光key消耗的空间甚至会超过value所占空间，这对空间的浪费十分严重，尤其是对大型数据集来说，因为它不仅不够紧凑，还要重复地加上key信息，
不仅会造成存储空间上的浪费，更会增加了数据传输的压力，从而给集群增加负担，进而影响整个集群的吞吐量。而采用Avro数据序列化系统可以比较好的解决此问题，
因为用Avro序列化后的文件由schema和真实内容组成，schema只是数据的元数据，相当于JSON数据的key信息，schema单独存放在一个JSON文件中，
这样一来，数据的元数据只存了一次，相比JSON数据格式的文件，大大缩小了存储容量。从而使得Avro文件可以更加紧凑地组织数据。









